# Story 4.3: 个人中心

## 基本信息

- **史诗**: Epic 4 - AI 问答与个人中心
- **故事编号**: 4.3
- **状态**: Done
- **优先级**: High
- **估算**: 3 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 查看和管理我的个人信息，
**以便** 了解我的活动状态。

## 验收标准

1. 个人中心页面创建完成
2. 用户资料编辑功能实现完成
3. 个人统计信息显示实现完成
4. 活动历史记录功能实现完成
5. 个人设置功能实现完成
6. 账户安全设置功能实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 页面结构

必须创建以下个人中心相关页面：

```
src/pages/
  me.astro            # 个人中心页面
```

#### 组件设计

必须创建以下个人中心组件：

```javascript
// 个人资料组件
<ProfileCard
  user={{}}
  onEdit={() => {}}
  onSave={() => {}}
/>

// 统计信息组件
<StatsCard
  stats={{}}
  onViewDetails={() => {}}
/>

// 活动历史组件
<ActivityHistory
  activities={[]}
  onLoadMore={() => {}}
/>
```

### API 设计要求 [Source: architecture/api-design.md]

#### 个人中心相关 API

必须实现以下 API 接口：

```javascript
// 获取用户信息
GET /api/profiles/:id

// 更新用户信息
PUT /api/profiles/:id
{
  "username": "新用户名",
  "bio": "新简介",
  "avatar_url": "新头像"
}

// 获取用户统计
GET /api/profiles/:id/stats

// 获取活动历史
GET /api/profiles/:id/activities?page=1&limit=20
```

### 数据库设计要求 [Source: architecture/database-design.md]

#### 用户表结构

```sql
CREATE TABLE profiles (
  id UUID PRIMARY KEY,
  username TEXT UNIQUE,
  avatar_url TEXT,
  bio TEXT,
  points INTEGER NOT NULL DEFAULT 0,
  level INTEGER NOT NULL DEFAULT 1,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 任务/子任务

### Task 1 (AC: 1) - 个人中心页面

- [ ] 创建 `src/pages/me.astro` 页面
- [ ] 实现个人中心布局
- [ ] 添加响应式设计
- [ ] 实现页面导航
- [ ] 测试页面功能

### Task 2 (AC: 2) - 用户资料编辑

- [ ] 实现资料编辑组件
- [ ] 添加表单验证
- [ ] 实现头像上传
- [ ] 添加保存功能
- [ ] 测试编辑功能

### Task 3 (AC: 3) - 个人统计信息

- [ ] 实现统计信息组件
- [ ] 添加统计图表
- [ ] 实现数据获取
- [ ] 添加统计更新
- [ ] 测试统计功能

### Task 4 (AC: 4) - 活动历史记录

- [ ] 实现活动历史组件
- [ ] 添加历史分页
- [ ] 实现历史筛选
- [ ] 添加历史详情
- [ ] 测试历史功能

### Task 5 (AC: 5) - 个人设置功能

- [ ] 实现设置组件
- [ ] 添加设置选项
- [ ] 实现设置保存
- [ ] 添加设置验证
- [ ] 测试设置功能

### Task 6 (AC: 6) - 账户安全设置

- [ ] 实现安全设置组件
- [ ] 添加密码修改
- [ ] 实现邮箱验证
- [ ] 添加安全日志
- [ ] 测试安全功能

### Task 7 - 单元测试

- [ ] 为个人中心组件创建测试
- [ ] 为 API 接口创建测试
- [ ] 为设置功能创建测试
- [ ] 为安全功能创建测试

## 技术约束

- 必须使用 Astro 框架
- 必须支持响应式设计
- 必须实现权限控制
- 必须优化性能
- 必须处理错误情况
- 必须保护用户隐私

## 依赖关系

- 依赖故事 4.2 的积分等级系统
- 依赖 Epic 1 的所有故事完成
- 依赖 Epic 2 的所有故事完成
- 依赖 Epic 3 的所有故事完成
- 后续故事将依赖此故事的个人功能

## 风险

- 个人信息可能泄露
- 权限控制可能出错
- 性能可能受影响
- 用户体验可能不佳

## 验收检查清单

- [ ] 个人中心页面正常显示
- [ ] 用户资料编辑正常
- [ ] 统计信息正确显示
- [ ] 活动历史功能正常
- [ ] 个人设置功能正常
- [ ] 账户安全设置正常
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况

- [ ] 待开发

### 遇到的问题

- 无

### 技术决策

- 无

### 完成备注

- 无
