# Story 3.6: 举报系统

## 基本信息

- **史诗**: Epic 3 - 社区互动系统
- **故事编号**: 3.6
- **状态**: Done
- **优先级**: Medium
- **估算**: 2 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 举报不当内容，
**以便** 维护社区环境。

## 验收标准

1. 举报功能实现完成，支持文本原因
2. 举报记录存储功能实现完成
3. 举报成功提示实现完成
4. 举报历史查看功能实现完成
5. 举报处理状态显示实现完成
6. 举报反馈功能实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 组件设计
必须创建以下举报组件：
```javascript
// 举报按钮组件
<ReportButton 
  entityType="post"
  entityId="uuid"
  onReport={() => {}}
/>

// 举报表单组件
<ReportForm 
  entityType="post"
  entityId="uuid"
  onSubmit={() => {}}
  onCancel={() => {}}
/>
```

### API设计要求 [Source: architecture/api-design.md]

#### 举报相关API
必须实现以下API接口：
```javascript
// 提交举报
POST /api/reports
{
  "entity_type": "post",
  "entity_id": "uuid",
  "reason": "举报原因"
}

// 获取举报历史
GET /api/reports?user_id=uuid&page=1&limit=20
```

### 数据库设计要求 [Source: architecture/database-design.md]

#### 举报表结构
```sql
CREATE TABLE reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  entity_type VARCHAR(20) NOT NULL CHECK (entity_type IN ('news', 'post', 'answer', 'comment')),
  entity_id UUID NOT NULL,
  user_id UUID REFERENCES profiles(id) NOT NULL,
  reason TEXT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'resolved', 'rejected')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 任务/子任务

### Task 1 (AC: 1) - 举报功能
- [ ] 实现举报按钮组件
- [ ] 添加举报表单
- [ ] 实现举报提交
- [ ] 添加举报验证
- [ ] 测试举报功能

### Task 2 (AC: 2) - 举报记录存储
- [ ] 完善reports表结构
- [ ] 实现举报记录插入
- [ ] 添加举报记录查询
- [ ] 实现举报记录更新
- [ ] 测试记录存储

### Task 3 (AC: 3) - 举报成功提示
- [ ] 实现成功提示组件
- [ ] 添加提示动画
- [ ] 实现提示消失
- [ ] 添加提示样式
- [ ] 测试成功提示

### Task 4 (AC: 4) - 举报历史查看
- [ ] 实现历史列表组件
- [ ] 添加历史分页
- [ ] 实现历史筛选
- [ ] 添加历史详情
- [ ] 测试历史查看

### Task 5 (AC: 5) - 举报处理状态
- [ ] 实现状态显示
- [ ] 添加状态图标
- [ ] 实现状态更新
- [ ] 添加状态说明
- [ ] 测试状态显示

### Task 6 (AC: 6) - 举报反馈功能
- [ ] 实现反馈组件
- [ ] 添加反馈表单
- [ ] 实现反馈提交
- [ ] 添加反馈显示
- [ ] 测试反馈功能

### Task 7 - 单元测试
- [ ] 为举报功能创建测试
- [ ] 为API接口创建测试
- [ ] 为状态管理创建测试
- [ ] 为反馈功能创建测试

## 技术约束

- 必须使用Astro框架
- 必须实现权限控制
- 必须优化性能
- 必须处理错误情况
- 必须支持状态管理
- 必须保护用户隐私

## 依赖关系

- 依赖故事3.4的评论系统
- 依赖故事3.5的点赞收藏系统
- 后续故事将依赖此故事的举报功能

## 风险

- 举报功能可能被滥用
- 状态管理可能复杂
- 隐私保护可能不足
- 用户体验可能不佳

## 验收检查清单

- [ ] 举报功能正常工作
- [ ] 举报记录正确存储
- [ ] 成功提示正确显示
- [ ] 历史查看功能正常
- [ ] 处理状态正确显示
- [ ] 反馈功能正常工作
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况
- [ ] 待开发

### 遇到的问题
- 无

### 技术决策
- 无

### 完成备注
- 无
