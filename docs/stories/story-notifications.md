# 用户故事：系统通知页面与已读状态

- ID: STORY-NTF-001
- 史诗：Epic 4：AI 问答与站内消息/通知
- 角色：登录用户
- 价值：我可以在一个页面集中查看系统通知，并将通知标记为已读，便于跟踪互动反馈（收到回答/点赞/评论等）。

## 故事描述

作为登录用户，当我收到与我相关的事件（他人点赞我的帖子/回答、有人在我的问题下发表评论或有新回答）时，我希望在“通知”页面查看这些通知，并能将其标记为已读，从而更高效地管理互动信息。

## 验收标准（Acceptance Criteria）

1. 进入 `/messages` 页面时，系统展示“对话/消息”与“系统通知”两个区块或 Tab。
2. 通知列表默认按时间倒序显示，至少包含类型、关联对象（ID 或跳转链接）、时间、是否已读。
3. 点击“标记已读”按钮后，通知 `read` 字段更新为 `true`，RLS 保证仅本人可更新自己的通知。
4. 未登录访问时，提示登录；登录后自动刷新列表。
5. 失败提示清晰（无回退/无模拟）。

## 完成定义（Definition of Done）

- 代码已合并，lint 通过；
- 单元测试编写并通过（期望/边界/失败三类）；
- 与 `notifications` 表及 RLS 策略匹配；
- 无控制台与运行时错误；
- 文档（README 任务或变更日志）更新；
- 关键路径在实际 Supabase 项目联调通过。

## 约束与实现要点

- 数据模型：`notifications(id, user_id, type, payload, created_at, read)`；仅本人可读；更新 `read=true` 仅本人可操作。
- 前端：在 `/messages` 中新增“系统通知”区块；新增“标记已读”操作；错误提示汉化。
- 不做：删除通知、批量已读（后续迭代）。

## 估算与优先级

- 故事点：3（小型增量，前后端改动小）
- 优先级：P1（提升可用性与反馈闭环，位于 Phase 2）
