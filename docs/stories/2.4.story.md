# Story 2.4: 新闻详情页面

## 基本信息

- **史诗**: Epic 2 - 新闻聚合与展示
- **故事编号**: 2.4
- **状态**: Done
- **优先级**: High
- **估算**: 3 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 查看新闻的完整内容，
**以便** 深入了解具体信息。

## 验收标准

1. 新闻详情页面创建完成
2. 新闻内容完整展示实现完成
3. 来源链接跳转功能实现完成
4. 浏览量统计功能实现完成
5. 分享功能实现完成
6. 相关新闻推荐功能实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 页面结构
必须创建以下新闻详情页面：
```
src/pages/
  news/
    [id].astro       # 新闻详情页面
```

#### 组件设计
必须创建以下新闻详情组件：
```javascript
// 新闻详情组件
<NewsDetail 
  id="uuid"
  title="新闻标题"
  content="新闻内容"
  source="来源"
  publishedAt="发布时间"
  author="作者"
  imageUrl="图片URL"
  tags={["AI", "编程"]}
  viewCount={100}
  onShare={() => {}}
  onLike={() => {}}
  onFavorite={() => {}}
/>

// 相关新闻组件
<RelatedNews 
  currentNewsId="uuid"
  relatedNews={[]}
  onNewsClick={() => {}}
/>
```

### API设计要求 [Source: architecture/api-design.md]

#### 新闻详情API
必须实现以下API接口：
```javascript
// 获取新闻详情
GET /api/news/:id

// 更新浏览量
POST /api/news/:id/view

// 获取相关新闻
GET /api/news/:id/related
```

#### 浏览量统计
- 每次访问增加浏览量
- 支持用户级别统计
- 防止重复计数
- 统计数据分析

### 数据库设计要求 [Source: architecture/database-design.md]

#### 浏览量表结构
```sql
CREATE TABLE views (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  entity_type TEXT NOT NULL CHECK (entity_type IN ('news', 'post', 'answer')),
  entity_id UUID NOT NULL,
  viewer_id UUID REFERENCES profiles(id),
  viewed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 索引优化
```sql
CREATE INDEX idx_views_entity ON views(entity_type, entity_id);
CREATE INDEX idx_views_viewer ON views(viewer_id);
```

### 内容展示要求 [Source: architecture/frontend-architecture.md]

#### 内容渲染
- 支持HTML内容渲染
- 图片自适应显示
- 代码高亮显示
- 响应式布局

#### 媒体处理
- 图片懒加载
- 图片压缩优化
- 视频播放支持
- 媒体文件管理

### 分享功能要求 [Source: architecture/frontend-architecture.md]

#### 分享方式
- 社交媒体分享
- 链接复制
- 二维码生成
- 邮件分享

#### 分享内容
- 新闻标题
- 新闻摘要
- 新闻链接
- 分享图片

### 相关新闻推荐 [Source: architecture/performance-optimization.md]

#### 推荐算法
- 基于标签相似度
- 基于来源相关性
- 基于时间相关性
- 基于用户兴趣

#### 推荐优化
- 缓存推荐结果
- 实时更新推荐
- 个性化推荐
- 推荐效果统计

### 性能优化要求 [Source: architecture/performance-optimization.md]

#### 页面优化
- 静态生成关键页面
- 图片CDN加速
- 内容预加载
- 缓存策略优化

#### 数据库优化
- 查询结果缓存
- 索引优化
- 连接池管理
- 查询性能监控

## 任务/子任务

### Task 1 (AC: 1) - 新闻详情页面
- [ ] 创建 `src/pages/news/[id].astro` 页面
- [ ] 实现新闻详情组件
- [ ] 添加响应式布局
- [ ] 实现内容渲染
- [ ] 测试页面功能

### Task 2 (AC: 2) - 新闻内容展示
- [ ] 实现HTML内容渲染
- [ ] 添加图片自适应
- [ ] 实现代码高亮
- [ ] 添加媒体处理
- [ ] 测试内容显示

### Task 3 (AC: 3) - 来源链接跳转
- [ ] 实现外部链接跳转
- [ ] 添加链接验证
- [ ] 实现新窗口打开
- [ ] 添加链接统计
- [ ] 测试链接功能

### Task 4 (AC: 4) - 浏览量统计
- [ ] 完善views表结构
- [ ] 实现浏览量增加
- [ ] 添加防重复计数
- [ ] 实现统计显示
- [ ] 测试统计功能

### Task 5 (AC: 5) - 分享功能
- [ ] 实现社交媒体分享
- [ ] 添加链接复制
- [ ] 实现二维码生成
- [ ] 添加邮件分享
- [ ] 测试分享功能

### Task 6 (AC: 6) - 相关新闻推荐
- [ ] 实现推荐算法
- [ ] 添加推荐组件
- [ ] 实现推荐缓存
- [ ] 添加推荐统计
- [ ] 测试推荐功能

### Task 7 - 单元测试
- [ ] 为详情页面创建测试
- [ ] 为API接口创建测试
- [ ] 为分享功能创建测试
- [ ] 为推荐功能创建测试

## 技术约束

- 必须使用Astro框架
- 必须支持响应式设计
- 必须实现浏览量统计
- 必须优化页面性能
- 必须支持分享功能
- 必须实现推荐算法

## 依赖关系

- 依赖故事2.1的新闻抓取系统
- 依赖故事2.2的新闻列表展示
- 依赖故事2.3的新闻筛选搜索
- 后续故事将依赖此故事的详情功能

## 风险

- 内容渲染可能复杂
- 浏览量统计可能不准确
- 分享功能可能受限
- 推荐算法可能不准确

## 验收检查清单

- [ ] 新闻详情页面正常显示
- [ ] 新闻内容完整展示
- [ ] 来源链接正常跳转
- [ ] 浏览量统计准确
- [ ] 分享功能正常
- [ ] 相关新闻推荐有效
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况
- [ ] 待开发

### 遇到的问题
- 无

### 技术决策
- 无

### 完成备注
- 无
