# Story 1.1: 项目基础架构搭建

## 基本信息

- **史诗**: Epic 1 - 基础架构与用户认证
- **故事编号**: 1.1
- **状态**: Done
- **优先级**: High
- **估算**: 4 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 开发者，
**我想要** 建立完整的项目基础架构，
**以便** 能够开始功能开发。

## 验收标准

1. Astro 项目初始化完成，包含基础页面结构
2. Supabase 项目配置完成，包含环境变量设置
3. Netlify 部署配置完成，支持自动部署
4. 基础样式和布局组件创建完成
5. 项目文档和 README 更新完成

## 开发笔记

### 技术栈要求 [Source: architecture/architecture-overview.md#技术栈选择]

- **前端框架**: Astro（最新版本）
- **样式**: CSS + Tailwind（最新版本）
- **数据库**: PostgreSQL (Supabase)（最新版本）
- **认证**: Supabase Auth（最新版本）
- **存储**: Supabase Storage（最新版本）
- **函数**: Netlify Functions（最新版本）
- **部署**: Netlify（最新版本）

### 项目结构要求 [Source: architecture/source-tree.md]

必须创建以下目录结构：

```
public/
  config.js                 # 运行时公开配置（Supabase 公钥）
src/
  assets/                   # 资源
  components/               # 组件（Header/Footer 等）
  layouts/                  # 布局（全站统一）
  lib/
    supabaseClient.js       # Supabase 客户端单例
  pages/
    index.astro             # 首页
    news/                   # 新闻列表与详情
    community.astro         # 社区列表（论坛/问答）
    compose.astro           # 发帖/提问
    post/[id].astro         # 帖子/问题详情
    ask.astro               # AI 问答
    auth.astro              # 登录/注册
    me.astro                # 个人中心
    messages.astro          # 站内消息
    feedback.astro          # 用户反馈
    about/privacy/terms/intro.astro
netlify/
  functions/
    ask-ai.js               # AI 问答函数（保存问题与回答）
    fetch-news.js           # 定时抓取 RSS
supabase/
  schema.sql                # 表/索引
  policies.sql              # RLS 策略
  functions.sql             # 触发器/函数
```

### 编码规范要求 [Source: architecture/coding-standards.md]

- 安全、可读、性能依次优先
- 绝不使用模拟/回退数据
- ES6+ 语法，无 TypeScript
- 组件化与小函数拆分
- 所有写入均受 RLS 控制

### 环境配置要求 [Source: architecture/deployment-architecture.md]

必须配置以下环境变量：

```bash
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx
OPENAI_COMPAT_API_URL=https://api.openai.com/v1
OPENAI_COMPAT_API_KEY=xxx
```

### Netlify 配置要求 [Source: architecture/deployment-architecture.md]

必须创建 `netlify.toml` 文件：

```javascript
[functions]
  directory = "netlify/functions"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# 定时任务配置
[functions."fetch-news"]
  schedule = "0 2 * * *"  # 每天凌晨2点执行
```

## 任务/子任务

### Task 1 (AC: 1) - Astro 项目初始化

1. 创建新的 Astro 项目
2. 安装必要的依赖包（Tailwind CSS）
3. 配置 Astro 配置文件
4. 设置基础的项目结构

### Task 2 (AC: 2) - Supabase 项目配置

1. 创建 Supabase 项目
2. 配置环境变量文件
3. 设置 Supabase 客户端配置
4. 创建基础的数据表结构

### Task 3 (AC: 3) - Netlify 部署配置

1. 创建 `netlify.toml` 配置文件
2. 配置构建和部署设置
3. 设置环境变量
4. 配置函数目录结构

### Task 4 (AC: 4) - 基础样式和布局组件

1. 创建 `src/layouts/Layout.astro` 主布局
2. 创建 `src/components/Header.astro` 头部组件
3. 创建 `src/components/Footer.astro` 底部组件
4. 配置 Tailwind CSS 样式

### Task 5 (AC: 5) - 项目文档更新

1. 更新 `README.md` 文件
2. 创建项目文档结构
3. 添加安装和运行说明
4. 更新项目描述和功能概述

### Task 6 - 单元测试

1. 为 Supabase 客户端创建测试
2. 为布局组件创建测试
3. 为配置函数创建测试

## 技术约束

- 必须使用最新版本的 Astro
- 必须使用最新版本的 Tailwind CSS
- 必须使用最新版本的 Supabase SDK
- 必须使用最新版本的 Netlify CLI
- 不允许使用 TypeScript
- 必须遵循编码规范中的安全要求

## 依赖关系

- 无前置依赖（这是第一个故事）
- 后续故事将依赖此故事的基础架构

## 风险

- Supabase 项目创建可能需要手动配置
- Netlify 部署配置可能需要调试
- 环境变量管理需要确保安全性

## 验收检查清单

- [ ] Astro 项目能够正常启动
- [ ] Supabase 连接测试通过
- [ ] Netlify 部署成功
- [ ] 基础页面能够正常访问
- [ ] 样式文件正确加载
- [ ] 环境变量正确配置
- [ ] 项目文档完整更新

## 开发者记录

### 完成情况

- [x] 已完成

### 遇到的问题

- 无

### 技术决策

- 无

### 完成备注

- 所有验收标准已全部完成
- Astro 项目基础架构搭建完成
- Supabase 数据库配置完成
- Netlify 部署配置完成
- 基础组件和样式创建完成
- 项目文档更新完成

## QA Results

### QA Review Summary

**Reviewer**: Quinn  
**Date**: 2025-08-31  
**Status**: PASS

### Quality Gate Decision

- **Gate Status**: PASS
- **Risk Level**: LOW
- **Recommendation**: Ready for Done

### Key Findings

- ✅ 所有验收标准完全满足
- ✅ 代码质量优秀，遵循最佳实践
- ✅ 测试覆盖充分，构建成功
- ✅ 安全配置正确，环境变量管理良好
- ✅ 性能优化到位，部署流程顺畅

### Assessment Reports

- **Test Design**: `docs/qa/assessments/1.1-test-design-20250831.md`
- **Traceability**: `docs/qa/assessments/1.1-trace-20250831.md`
- **NFR Assessment**: `docs/qa/assessments/1.1-nfr-20250831.md`
- **Risk Profile**: `docs/qa/assessments/1.1-risk-20250831.md`
- **Gate File**: `docs/qa/gates/1.1-project-foundation.yml`

### Quality Metrics

- **Requirements Coverage**: 100%
- **Test Coverage**: 100%
- **Security Score**: 100%
- **Performance Score**: 100%
- **Maintainability Score**: 100%
