# Story 3.5: 点赞和收藏系统

## 基本信息

- **史诗**: Epic 3 - 社区互动系统
- **故事编号**: 3.5
- **状态**: Done
- **优先级**: High
- **估算**: 2 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 点赞和收藏内容，
**以便** 表达喜好和保存内容。

## 验收标准

1. 点赞功能实现完成，支持取消
2. 收藏功能实现完成，不支持删除
3. 点赞状态显示实现完成
4. 收藏状态显示实现完成
5. 点赞数量统计显示实现完成
6. 收藏数量统计显示实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 组件设计
必须创建以下互动组件：
```javascript
// 点赞按钮组件
<LikeButton 
  entityType="post"
  entityId="uuid"
  isLiked={false}
  likeCount={10}
  onLike={() => {}}
/>

// 收藏按钮组件
<FavoriteButton 
  entityType="post"
  entityId="uuid"
  isFavorited={false}
  favoriteCount={5}
  onFavorite={() => {}}
/>
```

### API设计要求 [Source: architecture/api-design.md]

#### 互动相关API
必须实现以下API接口：
```javascript
// 点赞/取消点赞
POST /api/likes
{
  "entity_type": "post",
  "entity_id": "uuid"
}

// 收藏/取消收藏
POST /api/favorites
{
  "entity_type": "post",
  "entity_id": "uuid"
}
```

### 数据库设计要求 [Source: architecture/database-design.md]

#### 互动表结构
```sql
CREATE TABLE likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  entity_type VARCHAR(20) NOT NULL CHECK (entity_type IN ('news', 'post', 'answer')),
  entity_id UUID NOT NULL,
  user_id UUID REFERENCES profiles(id) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(entity_type, entity_id, user_id)
);

CREATE TABLE favorites (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  entity_type VARCHAR(20) NOT NULL CHECK (entity_type IN ('news', 'post', 'answer')),
  entity_id UUID NOT NULL,
  user_id UUID REFERENCES profiles(id) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(entity_type, entity_id, user_id)
);
```

## 任务/子任务

### Task 1 (AC: 1) - 点赞功能
- [ ] 实现点赞按钮组件
- [ ] 添加点赞状态管理
- [ ] 实现点赞切换
- [ ] 添加点赞动画
- [ ] 测试点赞功能

### Task 2 (AC: 2) - 收藏功能
- [ ] 实现收藏按钮组件
- [ ] 添加收藏状态管理
- [ ] 实现收藏切换
- [ ] 添加收藏动画
- [ ] 测试收藏功能

### Task 3 (AC: 3) - 点赞状态显示
- [ ] 实现点赞状态检查
- [ ] 添加状态图标
- [ ] 实现状态切换
- [ ] 添加状态提示
- [ ] 测试状态显示

### Task 4 (AC: 4) - 收藏状态显示
- [ ] 实现收藏状态检查
- [ ] 添加状态图标
- [ ] 实现状态切换
- [ ] 添加状态提示
- [ ] 测试状态显示

### Task 5 (AC: 5) - 点赞数量统计
- [ ] 实现数量获取
- [ ] 添加数量显示
- [ ] 实现实时更新
- [ ] 添加数量格式化
- [ ] 测试数量统计

### Task 6 (AC: 6) - 收藏数量统计
- [ ] 实现数量获取
- [ ] 添加数量显示
- [ ] 实现实时更新
- [ ] 添加数量格式化
- [ ] 测试数量统计

### Task 7 - 单元测试
- [ ] 为点赞功能创建测试
- [ ] 为收藏功能创建测试
- [ ] 为API接口创建测试
- [ ] 为状态管理创建测试

## 技术约束

- 必须使用Astro框架
- 必须支持实时更新
- 必须实现状态管理
- 必须优化性能
- 必须处理错误情况
- 必须支持动画效果

## 依赖关系

- 依赖故事3.3的帖子详情页面
- 依赖故事3.4的评论系统
- 后续故事将依赖此故事的互动功能

## 风险

- 实时更新可能复杂
- 状态同步可能出错
- 性能可能受影响
- 用户体验可能不佳

## 验收检查清单

- [ ] 点赞功能正常工作
- [ ] 收藏功能正常工作
- [ ] 点赞状态正确显示
- [ ] 收藏状态正确显示
- [ ] 点赞数量正确统计
- [ ] 收藏数量正确统计
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况
- [ ] 待开发

### 遇到的问题
- 无

### 技术决策
- 无

### 完成备注
- 无
