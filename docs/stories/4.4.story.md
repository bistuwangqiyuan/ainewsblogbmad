# Story 4.4: 敏感词过滤

## 基本信息

- **史诗**: Epic 4 - AI 问答与个人中心
- **故事编号**: 4.4
- **状态**: Done
- **优先级**: Medium
- **估算**: 2 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 系统管理员，
**我想要** 过滤不当内容，
**以便** 维护社区环境。

## 验收标准

1. 敏感词库管理功能实现完成
2. 前端预检功能实现完成
3. 后端强校验功能实现完成
4. 敏感词命中提示实现完成
5. 敏感词统计功能实现完成
6. 敏感词更新机制实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 组件设计

必须创建以下敏感词过滤组件：

```javascript
// 敏感词检测组件
<SensitiveWordCheck
  content=""
  onCheck={() => {}}
  onReplace={() => {}}
/>

// 敏感词提示组件
<SensitiveWordAlert
  words={[]}
  onConfirm={() => {}}
  onCancel={() => {}}
/>
```

### API 设计要求 [Source: architecture/api-design.md]

#### 敏感词过滤相关 API

必须实现以下 API 接口：

```javascript
// 检查敏感词
POST /api/sensitive/check
{
  "content": "要检查的内容"
}

// 获取敏感词库
GET /api/sensitive/words

// 更新敏感词库
POST /api/sensitive/words
{
  "words": ["敏感词1", "敏感词2"]
}
```

### 数据库设计要求 [Source: architecture/database-design.md]

#### 敏感词表结构

```sql
CREATE TABLE sensitive_words (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word TEXT UNIQUE NOT NULL,
  category VARCHAR(50),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE sensitive_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  content TEXT,
  matched_words TEXT[],
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 任务/子任务

### Task 1 (AC: 1) - 敏感词库管理

- [ ] 实现敏感词库组件
- [ ] 添加敏感词增删改查
- [ ] 实现敏感词分类
- [ ] 添加敏感词导入导出
- [ ] 测试词库管理

### Task 2 (AC: 2) - 前端预检功能

- [ ] 实现前端检测组件
- [ ] 添加实时检测
- [ ] 实现检测提示
- [ ] 添加检测配置
- [ ] 测试预检功能

### Task 3 (AC: 3) - 后端强校验

- [ ] 实现后端检测 API
- [ ] 添加检测算法
- [ ] 实现检测日志
- [ ] 添加检测统计
- [ ] 测试强校验

### Task 4 (AC: 4) - 敏感词命中提示

- [ ] 实现命中提示组件
- [ ] 添加提示样式
- [ ] 实现提示交互
- [ ] 添加提示配置
- [ ] 测试命中提示

### Task 5 (AC: 5) - 敏感词统计

- [ ] 实现统计组件
- [ ] 添加统计图表
- [ ] 实现统计查询
- [ ] 添加统计导出
- [ ] 测试统计功能

### Task 6 (AC: 6) - 敏感词更新机制

- [ ] 实现更新组件
- [ ] 添加更新策略
- [ ] 实现更新通知
- [ ] 添加更新日志
- [ ] 测试更新机制

### Task 7 - 单元测试

- [ ] 为敏感词检测创建测试
- [ ] 为 API 接口创建测试
- [ ] 为统计功能创建测试
- [ ] 为更新机制创建测试

## 技术约束

- 必须使用 Astro 框架
- 必须实现实时检测
- 必须优化性能
- 必须处理错误情况
- 必须支持配置管理
- 必须保护用户隐私

## 依赖关系

- 依赖故事 4.3 的个人中心
- 依赖 Epic 1 的所有故事完成
- 依赖 Epic 2 的所有故事完成
- 依赖 Epic 3 的所有故事完成
- 后续故事将依赖此故事的过滤功能

## 风险

- 敏感词检测可能误判
- 性能可能受影响
- 用户体验可能不佳
- 隐私保护可能不足

## 验收检查清单

- [ ] 敏感词库管理正常
- [ ] 前端预检功能正常
- [ ] 后端强校验正常
- [ ] 命中提示正确显示
- [ ] 敏感词统计正常
- [ ] 更新机制正常工作
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况

- [ ] 待开发

### 遇到的问题

- 无

### 技术决策

- 无

### 完成备注

- 无
