# Story 2.2: 新闻列表展示

## 基本信息

- **史诗**: Epic 2 - 新闻聚合与展示
- **故事编号**: 2.2
- **状态**: Done
- **优先级**: High
- **估算**: 4 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 浏览新闻列表，
**以便** 了解最新的 AI 编程动态。

## 验收标准

1. 新闻列表页面创建完成，支持卡片式布局
2. 分页功能实现完成，20条/页
3. 时间排序功能实现完成，最新优先
4. 响应式设计实现完成，支持移动端
5. 加载状态和错误处理实现完成
6. 新闻预览功能实现完成

## 开发笔记

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 页面结构
必须创建以下新闻相关页面：
```
src/pages/
  news/
    index.astro      # 新闻列表页面
    [id].astro       # 新闻详情页面
```

#### 组件设计
必须创建以下新闻组件：
```javascript
// 新闻卡片组件
<NewsCard 
  title="新闻标题"
  summary="新闻摘要"
  source="来源"
  publishedAt="发布时间"
  imageUrl="图片URL"
  tags={["AI", "编程"]}
  onLike={() => {}}
  onFavorite={() => {}}
/>
```

### API设计要求 [Source: architecture/api-design.md]

#### 新闻相关API
必须实现以下API接口：
```javascript
// 获取新闻列表
GET /api/news?page=1&limit=20&source=openai&search=ai

// 获取新闻详情
GET /api/news/:id

// 获取新闻统计
GET /api/news/stats
```

#### 分页参数
- `page`: 页码，从1开始
- `limit`: 每页数量，默认20
- `source`: 新闻来源筛选
- `search`: 关键词搜索

### 数据库设计要求 [Source: architecture/database-design.md]

#### 新闻表结构
```sql
CREATE TABLE news_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(500) NOT NULL,
  url TEXT UNIQUE NOT NULL,
  source VARCHAR(100) NOT NULL,
  published_at TIMESTAMP WITH TIME ZONE,
  summary TEXT,
  author VARCHAR(100),
  image_url TEXT,
  tags TEXT[],
  content_html TEXT,
  hash VARCHAR(64) UNIQUE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 索引优化
```sql
CREATE INDEX idx_news_items_published_at ON news_items(published_at DESC);
CREATE INDEX idx_news_items_source ON news_items(source);
CREATE INDEX idx_news_items_hash ON news_items(hash);
```

### 状态管理要求 [Source: architecture/frontend-architecture.md]

#### 新闻状态
```javascript
// 新闻状态
const newsStore = {
  items: [],
  loading: false,
  filters: {
    source: null,
    search: null,
    page: 1
  }
};
```

### 性能优化要求 [Source: architecture/performance-optimization.md]

#### 前端优化
- **静态生成**: Astro 预渲染关键页面
- **代码分割**: 按路由分割 JavaScript
- **图片优化**: 自动格式转换和压缩
- **缓存策略**: 浏览器缓存 + CDN 缓存

#### 数据库优化
- **索引设计**: 关键查询字段建立索引
- **查询优化**: 避免 N+1 查询问题
- **连接池**: 数据库连接复用
- **分页优化**: 游标分页替代偏移分页

### 响应式设计要求 [Source: architecture/frontend-architecture.md]

#### 移动端适配
- 卡片布局自适应
- 触摸友好的交互
- 优化的图片加载
- 简化的导航菜单

#### 桌面端优化
- 多列布局
- 悬停效果
- 键盘导航
- 高级筛选

## 任务/子任务

### Task 1 (AC: 1) - 新闻列表页面
- [ ] 创建 `src/pages/news/index.astro` 页面
- [ ] 实现卡片式布局设计
- [ ] 添加新闻卡片组件
- [ ] 实现响应式布局
- [ ] 添加加载动画

### Task 2 (AC: 2) - 分页功能
- [ ] 实现分页逻辑
- [ ] 添加分页组件
- [ ] 配置每页20条显示
- [ ] 实现页码导航
- [ ] 添加分页状态管理

### Task 3 (AC: 3) - 时间排序
- [ ] 实现按发布时间排序
- [ ] 配置最新优先排序
- [ ] 添加排序选项
- [ ] 优化排序性能
- [ ] 测试排序功能

### Task 4 (AC: 4) - 响应式设计
- [ ] 实现移动端适配
- [ ] 添加触摸交互
- [ ] 优化图片加载
- [ ] 测试不同屏幕尺寸
- [ ] 优化用户体验

### Task 5 (AC: 5) - 加载和错误处理
- [ ] 实现加载状态显示
- [ ] 添加错误处理机制
- [ ] 实现重试功能
- [ ] 添加错误提示
- [ ] 测试异常情况

### Task 6 (AC: 6) - 新闻预览
- [ ] 实现新闻摘要显示
- [ ] 添加图片预览
- [ ] 显示标签信息
- [ ] 添加来源信息
- [ ] 实现预览交互

### Task 7 - 单元测试
- [ ] 为新闻组件创建测试
- [ ] 为API接口创建测试
- [ ] 为分页功能创建测试
- [ ] 为响应式设计创建测试

## 技术约束

- 必须使用Astro框架
- 必须支持响应式设计
- 必须实现分页功能
- 必须优化性能
- 必须处理错误情况
- 必须支持移动端

## 依赖关系

- 依赖故事2.1的新闻抓取系统
- 依赖Epic 1的所有故事完成
- 后续故事将依赖此故事的新闻展示

## 风险

- 大量数据可能影响性能
- 移动端适配复杂
- 图片加载可能慢
- 分页可能影响用户体验

## 验收检查清单

- [ ] 新闻列表页面正常显示
- [ ] 分页功能正常工作
- [ ] 时间排序正确
- [ ] 响应式设计有效
- [ ] 加载状态正常
- [ ] 错误处理有效
- [ ] 新闻预览完整
- [ ] 单元测试通过

## 开发者记录

### 完成情况
- [ ] 待开发

### 遇到的问题
- 无

### 技术决策
- 无

### 完成备注
- 无
