# Story 2.3: 新闻筛选和搜索

## 基本信息

- **史诗**: Epic 2 - 新闻聚合与展示
- **故事编号**: 2.3
- **状态**: Done
- **优先级**: High
- **估算**: 3 hours
- **创建日期**: 2025-08-31
- **创建者**: Bob (SM)

## 用户故事

**作为** 用户，
**我想要** 按条件筛选和搜索新闻，
**以便** 快速找到感兴趣的内容。

## 验收标准

1. 按来源筛选功能实现完成
2. 按时间范围筛选功能实现完成
3. 按关键词搜索功能实现完成
4. 筛选条件组合功能实现完成
5. 搜索历史记录功能实现完成
6. 筛选结果统计显示实现完成

## 开发笔记

### 筛选功能设计要求 [Source: architecture/api-design.md]

#### 筛选参数
```javascript
// 获取新闻列表（带筛选）
GET /api/news?page=1&limit=20&source=openai&search=ai&dateFrom=2024-01-01&dateTo=2024-12-31
```

#### 筛选参数说明
- `source`: 新闻来源筛选
- `search`: 关键词搜索
- `dateFrom`: 开始日期
- `dateTo`: 结束日期
- `tags`: 标签筛选
- `author`: 作者筛选

### 前端架构要求 [Source: architecture/frontend-architecture.md]

#### 筛选组件设计
必须创建以下筛选组件：
```javascript
// 筛选表单组件
<NewsFilter 
  sources={["OpenAI", "DeepMind", "Google AI"]}
  dateRange={{from: null, to: null}}
  searchQuery=""
  onFilterChange={() => {}}
  onSearch={() => {}}
/>

// 搜索历史组件
<SearchHistory 
  history={["AI", "Machine Learning", "Deep Learning"]}
  onHistoryClick={() => {}}
  onClearHistory={() => {}}
/>
```

#### 状态管理
筛选状态管理要求：
```javascript
// 筛选状态
const filterStore = {
  sources: [],
  dateRange: {from: null, to: null},
  searchQuery: "",
  tags: [],
  author: null,
  searchHistory: []
};
```

### 数据库设计要求 [Source: architecture/database-design.md]

#### 搜索历史表
```sql
CREATE TABLE search_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES profiles(id),
  query TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

#### 查询优化
```sql
-- 复合索引支持多条件筛选
CREATE INDEX idx_news_items_source_date ON news_items(source, published_at DESC);
CREATE INDEX idx_news_items_tags ON news_items USING GIN(tags);
CREATE INDEX idx_news_items_title_search ON news_items USING GIN(to_tsvector('english', title));
```

### 搜索功能要求 [Source: architecture/performance-optimization.md]

#### 全文搜索
- 使用PostgreSQL全文搜索
- 支持标题和摘要搜索
- 支持标签搜索
- 搜索结果排序

#### 搜索优化
- 搜索建议功能
- 拼写纠错
- 相关搜索
- 搜索统计

### 筛选组件要求 [Source: architecture/frontend-architecture.md]

#### 来源筛选
- 多选来源
- 来源统计
- 快速选择
- 自定义来源

#### 时间筛选
- 日期范围选择
- 预设时间范围
- 相对时间筛选
- 时间格式化

#### 标签筛选
- 标签云显示
- 多选标签
- 标签统计
- 标签搜索

### 用户体验要求 [Source: architecture/frontend-architecture.md]

#### 交互设计
- 实时筛选
- 筛选条件显示
- 清除筛选
- 筛选结果提示

#### 性能优化
- 防抖搜索
- 懒加载结果
- 缓存筛选条件
- 优化查询性能

## 任务/子任务

### Task 1 (AC: 1) - 来源筛选功能
- [ ] 实现来源多选组件
- [ ] 添加来源统计显示
- [ ] 实现来源快速选择
- [ ] 添加来源搜索功能
- [ ] 测试来源筛选

### Task 2 (AC: 2) - 时间范围筛选
- [ ] 实现日期范围选择器
- [ ] 添加预设时间范围
- [ ] 实现相对时间筛选
- [ ] 添加时间格式化
- [ ] 测试时间筛选

### Task 3 (AC: 3) - 关键词搜索
- [ ] 实现全文搜索功能
- [ ] 添加搜索建议
- [ ] 实现拼写纠错
- [ ] 添加搜索结果高亮
- [ ] 测试搜索功能

### Task 4 (AC: 4) - 筛选条件组合
- [ ] 实现多条件组合筛选
- [ ] 添加筛选条件显示
- [ ] 实现筛选条件清除
- [ ] 添加筛选结果统计
- [ ] 测试组合筛选

### Task 5 (AC: 5) - 搜索历史记录
- [ ] 创建search_history表
- [ ] 实现搜索历史存储
- [ ] 添加搜索历史显示
- [ ] 实现历史记录点击
- [ ] 测试历史功能

### Task 6 (AC: 6) - 筛选结果统计
- [ ] 实现结果数量统计
- [ ] 添加筛选条件统计
- [ ] 实现结果分布显示
- [ ] 添加统计图表
- [ ] 测试统计功能

### Task 7 - 单元测试
- [ ] 为筛选组件创建测试
- [ ] 为搜索功能创建测试
- [ ] 为API接口创建测试
- [ ] 为性能优化创建测试

## 技术约束

- 必须使用PostgreSQL全文搜索
- 必须支持多条件组合
- 必须实现实时筛选
- 必须优化查询性能
- 必须支持搜索历史
- 必须处理大量数据

## 依赖关系

- 依赖故事2.1的新闻抓取系统
- 依赖故事2.2的新闻列表展示
- 后续故事将依赖此故事的筛选功能

## 风险

- 复杂查询可能影响性能
- 大量数据筛选可能慢
- 搜索功能可能不准确
- 用户体验可能复杂

## 验收检查清单

- [ ] 来源筛选功能正常
- [ ] 时间筛选功能正常
- [ ] 关键词搜索正常
- [ ] 组合筛选正常
- [ ] 搜索历史正常
- [ ] 结果统计正常
- [ ] 性能测试通过
- [ ] 单元测试通过

## 开发者记录

### 完成情况
- [ ] 待开发

### 遇到的问题
- 无

### 技术决策
- 无

### 完成备注
- 无
